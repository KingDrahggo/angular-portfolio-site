version: 1
applications:
  - appRoot: front-end/portfolio-site
    frontend:
      phases:
        preBuild:
          commands:
            - nvm install 18.19.1
            - nvm use 18.19.1
            - node -v
            - npm install
        build:
          commands:
            - npm run build
      artifacts:
        baseDirectory: dist/portfolio-site  # Make sure this path is correct
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
      headers:
        - source: "**/*.js"
          headers:
            - key: "Content-Type"
              value: "application/javascript"
      redirects:
        - source: "/<*>"
          target: "/index.html"
          status: 200
      environment:
        variables:
          NODE_ENV: production
          API_URL: "http://localhost:3000/email"

    backend:
      phases:
        preBuild:
          commands:
            - npm ci
        build:
          commands:
            - npm run build  # Ensure this matches the actual backend build command
      artifacts:
        baseDirectory: dist/portfolio-site  # Update to the correct backend output directory
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
